<script src'https://maps.google.com/maps/api/js?v=3.23&key=#{ENV[GMAPS_KEY]}'></script>
<script src='https://cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js'></script>
<script src='https://cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->

<div class="container">

  <div class="row">
    <div id="map" class="col s12 m6" style='height: 600px;'></div>
    <%=render(partial: 'form')%>
  </div>
    <hr/>

    <% if @yelp_results %>
        <% @yelp_results.businesses.each do |yelp| %>
        <div class="col s12 m4">
          <p><b>Shelter: </b><%= yelp.name %></p>
          <p><b>Rating: </b><%= yelp.rating %></p>
          <p><b>Category: </b><%= yelp.categories.map { |a| a.first  }.join(" / ") %></p>
          <p><b>Address: </b><%= yelp.location.display_address.first %></p>
          <p><%= yelp.location.display_address.last %></p>
          <p><b>Contact Number: </b><%= number_to_phone(yelp.phone) %></p>
          <p><a target="_blank" href="<%= yelp.mobile_url %>">Click here for site link</a></p>
          <hr/>
        </div>
        <% end %>
        <hr/>
      </div>
    <% end %>
<script>
<% if @hash %>
  var marker_info = <%=raw @hash.to_json %>
  var timeout = 0;
<% else %>
  var marker_info
  navigator.geolocation.getCurrentPosition(function(position) {
    marker_info = {lat:position.coords.latitude,lng:position.coords.longitude};
  });
  var timeout = 0;
<% end %>
setTimeout(function(){
  console.log(marker_info)
  handler = Gmaps.build('Google');
  handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
    var markers = handler.addMarkers(marker_info);
    handler.bounds.extendWith(markers);
    handler.fitMapToBounds();
  });
}, timeout ) 
</script>
