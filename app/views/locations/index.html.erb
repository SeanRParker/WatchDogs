<script src="//maps.google.com/maps/api/js?v=3.23&key=#{ENV[GMAPS_KEY]}"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->

<div class="container">
<%= yield :scripts %>

  <div class="row">
    <div id="map" class="col s12 m6" style='height: 600px;'></div>



    <%=render(partial: 'form')%>

    <hr/>

    <% if @yelp_results %>

        <% @yelp_results.businesses.each do |yelp| %>
        <div class="col s12 m4">
          <p><b>Name:</b><%= yelp.name %></p>
          <p><b>Rating:</b><%= yelp.rating %></p>
          <p><<%= yelp.categories.map { |a| a.first  }.join(" / ") %></p>
          <p><%= yelp.location.display_address.first %></p>
          <p><%= yelp.location.display_address.last %></p>
          <p><%= yelp.location.neighborhoods %></p>
          <p><%= yelp.id %></p>
          <p><%= yelp.phone %></p>
          <p><%= yelp.mobile_url %></p>
        </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
<% end %>
<script>
<% if @hash %>
var marker_info = <%=raw @hash.to_json %>
<% else %>
var marker_info
navigator.geolocation.getCurrentPosition(function(position) {
  marker_info = ([{lat:position.coords.latitude,lng:position.coords.longitude}]);
});
<% end %>
console.log(marker_info)
handler = Gmaps.build('Google');
handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
  var markers = handler.addMarkers(marker_info);
  handler.bounds.extendWith(markers);
  handler.fitMapToBounds();
});
</script>
